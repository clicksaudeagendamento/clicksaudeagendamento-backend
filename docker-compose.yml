version: '3.8'

services:
  app:
    build: .
    container_name: clicksaudeagendamento
    env_file:
      - .env
    environment:
      - PORT=${PORT}
      - MONGO_URI=${MONGO_URI}
      - REDIS_HOST=${REDIS_HOST}
      - REDIS_PORT=${REDIS_PORT}
      - REDIS_PASSWORD=${REDIS_PASSWORD}
      - BULL_BOARD_PASSWORD=${BULL_BOARD_PASSWORD}
      - JWT_SECRET=${JWT_SECRET}
      - TZ=America/Fortaleza
    restart: always
    volumes:
      # WhatsApp session persistence
      - wwebjs-auth:/app/.wwebjs_auth
      - wwebjs-cache:/app/.wwebjs_cache
      - sessions:/app/sessions
      # Uploads persistence
      - uploads:/app/uploads
    ports:
      - "4000:4000"
    networks:
      - mongo
      - redis
      - clicksaudeagendamento

volumes:
  wwebjs-auth:
  wwebjs-cache:
  sessions:
  uploads:

networks:
  mongo:
    external: true
  redis:
    external: true
  clicksaudeagendamento:
    name: clicksaudeagendamento